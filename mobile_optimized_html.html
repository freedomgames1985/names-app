<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<title>Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø³Ù…Ø§Ø¡</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --primary:#3b82f6;
  --primary-dark:#2563eb;
  --success:#10b981;
  --danger:#ef4444;
  --warning:#f59e0b;
  --dark:#1f2937;
  --gray:#6b7280;
  --light-bg:#f9fafb;
  --border:#e5e7eb;
}

*{
  box-sizing:border-box;
  margin:0;
  padding:0;
}

body{
  font-family:'Tajawal',sans-serif;
  background:#f3f4f6;
  color:var(--dark);
  padding:16px;
  line-height:1.6;
}

.container{
  max-width:1400px;
  margin:0 auto;
}

header{
  background:white;
  padding:20px 24px;
  border-radius:12px;
  box-shadow:0 1px 3px rgba(0,0,0,0.1);
  margin-bottom:20px;
}

.header-content{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:16px;
  flex-wrap:wrap;
}

h1{
  font-size:22px;
  color:var(--primary);
  font-weight:700;
  display:flex;
  align-items:center;
  gap:8px;
}

.stats{
  display:flex;
  gap:12px;
  flex-wrap:wrap;
}

.stat{
  background:linear-gradient(135deg,var(--primary),var(--primary-dark));
  color:white;
  padding:8px 16px;
  border-radius:8px;
  font-size:13px;
  font-weight:600;
  display:flex;
  align-items:center;
  gap:6px;
}

.main-grid{
  display:grid;
  grid-template-columns:350px 1fr;
  gap:20px;
  align-items:start;
}

.sidebar{
  display:flex;
  flex-direction:column;
  gap:16px;
}

.card{
  background:white;
  border-radius:12px;
  padding:20px;
  box-shadow:0 1px 3px rgba(0,0,0,0.1);
}

.card-title{
  font-size:16px;
  font-weight:700;
  color:var(--dark);
  margin-bottom:16px;
  padding-bottom:12px;
  border-bottom:2px solid var(--border);
  display:flex;
  align-items:center;
  gap:8px;
}

.search-group{
  display:flex;
  gap:8px;
  margin-bottom:12px;
}

.search-group input{
  flex:1;
  padding:10px 14px;
  border:1px solid var(--border);
  border-radius:8px;
  font-size:14px;
  font-weight:500;
  outline:none;
  transition:all 0.2s;
}

.search-group input:focus{
  border-color:var(--primary);
  box-shadow:0 0 0 3px rgba(59,130,246,0.1);
}

.btn{
  padding:10px 16px;
  border:none;
  border-radius:8px;
  font-size:13px;
  font-weight:600;
  cursor:pointer;
  transition:all 0.2s;
  display:inline-flex;
  align-items:center;
  gap:6px;
  justify-content:center;
  white-space:nowrap;
}

.btn-primary{
  background:var(--primary);
  color:white;
}

.btn-primary:hover{
  background:var(--primary-dark);
  transform:translateY(-1px);
}

.btn-success{
  background:var(--success);
  color:white;
}

.btn-success:hover{
  background:#059669;
  transform:translateY(-1px);
}

.btn-danger{
  background:var(--danger);
  color:white;
}

.btn-danger:hover{
  background:#dc2626;
  transform:translateY(-1px);
}

.btn-warning{
  background:var(--warning);
  color:white;
}

.btn-warning:hover{
  background:#d97706;
  transform:translateY(-1px);
}

.btn-outline{
  background:white;
  color:var(--gray);
  border:1px solid var(--border);
}

.btn-outline:hover{
  background:var(--light-bg);
  border-color:var(--primary);
  color:var(--primary);
}

.btn-group{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:8px;
}

.btn-full{
  width:100%;
}

.form-group{
  margin-bottom:14px;
}

.form-group label{
  display:block;
  font-size:13px;
  font-weight:600;
  color:var(--dark);
  margin-bottom:6px;
}

.form-group input,
.form-group select,
.form-group textarea{
  width:100%;
  padding:10px 12px;
  border:1px solid var(--border);
  border-radius:8px;
  font-size:14px;
  font-weight:500;
  outline:none;
  transition:all 0.2s;
  font-family:'Tajawal',sans-serif;
}

.form-group input:focus,
.form-group select:focus,
.form-group textarea:focus{
  border-color:var(--primary);
  box-shadow:0 0 0 3px rgba(59,130,246,0.1);
}

.form-group textarea{
  min-height:80px;
  resize:vertical;
}

.form-grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:12px;
}

.divider{
  height:1px;
  background:var(--border);
  margin:16px 0;
}

.results-area{
  min-height:300px;
}

.result-item{
  background:var(--light-bg);
  border:1px solid var(--border);
  border-radius:8px;
  padding:14px;
  margin-bottom:10px;
  cursor:pointer;
  transition:all 0.2s;
}

.result-item:hover{
  border-color:var(--primary);
  box-shadow:0 2px 8px rgba(59,130,246,0.1);
  transform:translateX(-3px);
}

.result-name{
  font-size:15px;
  font-weight:700;
  color:var(--dark);
  margin-bottom:8px;
}

.result-info{
  display:flex;
  gap:12px;
  flex-wrap:wrap;
  font-size:12px;
  color:var(--gray);
}

.result-badge{
  background:white;
  padding:4px 10px;
  border-radius:6px;
  font-weight:600;
  border:1px solid var(--border);
}

.badge-success{
  color:var(--success);
  border-color:var(--success);
  background:rgba(16,185,129,0.1);
}

.badge-danger{
  color:var(--danger);
  border-color:var(--danger);
  background:rgba(239,68,68,0.1);
}

.empty-state{
  text-align:center;
  padding:40px 20px;
  color:var(--gray);
}

.empty-icon{
  font-size:48px;
  opacity:0.3;
  margin-bottom:12px;
}

.modal{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.5);
  z-index:1000;
  padding:20px;
  align-items:center;
  justify-content:center;
  backdrop-filter:blur(4px);
}

.modal-content{
  background:white;
  border-radius:12px;
  padding:24px;
  max-width:500px;
  width:100%;
  max-height:80vh;
  overflow-y:auto;
  box-shadow:0 20px 60px rgba(0,0,0,0.3);
}

.modal-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:16px;
  padding-bottom:12px;
  border-bottom:2px solid var(--border);
}

.modal-title{
  font-size:18px;
  font-weight:700;
  color:var(--dark);
}

.modal-close{
  background:var(--danger);
  color:white;
  border:none;
  width:32px;
  height:32px;
  border-radius:50%;
  cursor:pointer;
  font-size:18px;
  display:flex;
  align-items:center;
  justify-content:center;
  transition:all 0.2s;
}

.modal-close:hover{
  transform:rotate(90deg);
}

.alert{
  padding:14px;
  border-radius:8px;
  font-size:14px;
  font-weight:500;
  line-height:1.6;
}

.alert-success{
  background:rgba(16,185,129,0.1);
  color:#065f46;
  border-right:3px solid var(--success);
}

.alert-danger{
  background:rgba(239,68,68,0.1);
  color:#991b1b;
  border-right:3px solid var(--danger);
}

.alert-warning{
  background:rgba(245,158,11,0.1);
  color:#92400e;
  border-right:3px solid var(--warning);
}

.alert-info{
  background:rgba(59,130,246,0.1);
  color:#1e40af;
  border-right:3px solid var(--primary);
}

.section-divider{
  margin:16px 0;
  padding:8px 12px;
  background:var(--light-bg);
  border-radius:6px;
  font-size:12px;
  font-weight:600;
  color:var(--gray);
  text-transform:uppercase;
  letter-spacing:0.5px;
}

@media (max-width:1024px){
  .main-grid{
    grid-template-columns:1fr;
  }
  
  .sidebar{
    order:2;
  }
  
  .results-area{
    order:1;
  }
}

@media (max-width:768px){
  body{
    padding:8px;
  }
  
  h1{
    font-size:18px;
  }
  
  .header-content{
    flex-direction:column;
    align-items:stretch;
  }
  
  .stats{
    width:100%;
  }
  
  .stat{
    flex:1;
    justify-content:center;
  }
  
  .search-group{
    flex-direction:column;
  }
  
  .form-grid{
    grid-template-columns:1fr;
  }
  
  .btn-group{
    grid-template-columns:1fr;
  }
  
  .card{
    padding:16px;
  }
}
</style>
</head>
<body>

<div class="container">
  <header>
    <div class="header-content">
      <h1>ğŸ—‚ï¸ Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø³Ù…Ø§Ø¡</h1>
      <div class="stats">
        <div class="stat">ğŸ“Š Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <span id="totalCount">0</span></div>
        <div class="stat">âœ… Ù…ØªÙˆÙØ±: <span id="availableCount">0</span></div>
        <div class="stat">âŒ Ù†Ø§Ù‚Øµ: <span id="missingCount">0</span></div>
      </div>
    </div>
  </header>

  <div class="main-grid">
    <!-- Sidebar - Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª -->
    <div class="sidebar">
      
      <!-- Ø§Ù„Ø¨Ø­Ø« -->
      <div class="card">
        <div class="card-title">ğŸ” Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„Ø¹Ø±Ø¶</div>
        <div class="search-group">
          <input type="text" id="searchInput" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ø³Ù…..." autocomplete="off">
          <button class="btn btn-primary" id="searchBtn">Ø¨Ø­Ø«</button>
        </div>
        <div class="btn-group">
          <button class="btn btn-outline btn-full" id="showAllBtn">ğŸ“‹ Ø§Ù„ÙƒÙ„</button>
          <button class="btn btn-outline btn-full" id="showMissingBtn">âŒ Ù†Ø§Ù‚Øµ</button>
        </div>
      </div>

      <!-- Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø³Ø¬Ù„Ø§Øª -->
      <div class="card">
        <div class="card-title">âœï¸ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø³Ø¬Ù„Ø§Øª</div>
        
        <div class="form-group">
          <label>Ø§Ù„Ø§Ø³Ù…</label>
          <input type="text" id="nameInput" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù…">
        </div>
        
        <div class="form-grid">
          <div class="form-group">
            <label>Ø§Ù„ÙƒÙ…ÙŠØ©</label>
            <input type="number" id="qtyInput" placeholder="0" min="0">
          </div>
          <div class="form-group">
            <label>Ø§Ù„Ø¬Ù†Ø³</label>
            <select id="genderInput">
              <option value="">Ø§Ø®ØªØ±</option>
              <option value="Ø°ÙƒØ±">ğŸ‘¦ Ø°ÙƒØ±</option>
              <option value="Ø£Ù†Ø«Ù‰">ğŸ‘§ Ø£Ù†Ø«Ù‰</option>
            </select>
          </div>
        </div>
        
        <div class="form-group">
          <label>Ø§Ù„Ù„ÙˆÙ†</label>
          <input type="text" id="colorInput" placeholder="Ø§Ù„Ù„ÙˆÙ†">
        </div>
        
        <div class="form-group">
          <label>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
          <textarea id="noteInput" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©..."></textarea>
        </div>
        
        <div class="section-divider">Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</div>
        
        <div class="btn-group">
          <button class="btn btn-success btn-full" id="addBtn">â• Ø¥Ø¶Ø§ÙØ©</button>
          <button class="btn btn-primary btn-full" id="updateBtn">âœï¸ ØªØ­Ø¯ÙŠØ«</button>
          <button class="btn btn-danger btn-full" id="deleteBtn">ğŸ—‘ï¸ Ø­Ø°Ù</button>
          <button class="btn btn-outline btn-full" id="clearFormBtn">ğŸ§¹ Ù…Ø³Ø­</button>
        </div>
      </div>

      <!-- Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¨ÙŠØ¹ -->
      <div class="card">
        <div class="card-title">ğŸ›’ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¨ÙŠØ¹</div>
        
        <div class="form-group">
          <label>Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬</label>
          <input type="text" id="sellNameInput" placeholder="Ø§Ù„Ø§Ø³Ù…">
        </div>
        
        <div class="form-group">
          <label>Ø§Ù„ÙƒÙ…ÙŠØ©</label>
          <input type="number" id="sellQtyInput" placeholder="0" min="1">
        </div>
        
        <div class="btn-group">
          <button class="btn btn-warning btn-full" id="sellBtn">ğŸ’° Ø¨ÙŠØ¹</button>
          <button class="btn btn-outline btn-full" id="checkSellBtn">ğŸ” ÙØ­Øµ</button>
        </div>
      </div>

      <!-- Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ -->
      <div class="card">
        <div class="card-title">ğŸ’¾ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ</div>
        
        <div class="btn-group">
          <button class="btn btn-success btn-full" id="backupBtn">â¬‡ï¸ ØªØ­Ù…ÙŠÙ„</button>
          <button class="btn btn-primary btn-full" id="restoreBtn">â¬†ï¸ Ø§Ø³ØªØ±Ø¯Ø§Ø¯</button>
        </div>
        
        <div id="fileUploadArea" style="display:none;margin-top:12px;padding:20px;border:2px dashed var(--border);border-radius:8px;text-align:center;cursor:pointer;background:var(--light-bg)">
          <div style="font-size:32px;margin-bottom:8px">ğŸ“</div>
          <div style="font-size:13px;font-weight:600;color:var(--gray)">Ø§Ù†Ù‚Ø± Ù„Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù CSV</div>
          <input type="file" id="fileInput" accept=".csv" style="display:none">
        </div>
      </div>
      
    </div>

    <!-- Ø§Ù„Ù†ØªØ§Ø¦Ø¬ -->
    <div class="card results-area">
      <div class="card-title">ğŸ“Š Ø§Ù„Ù†ØªØ§Ø¦Ø¬</div>
      <div id="searchResults">
        <div class="empty-state">
          <div class="empty-icon">ğŸ”</div>
          <div style="font-weight:600">Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¨Ø­Ø« Ø£Ùˆ Ø§Ø¶ØºØ· "Ø§Ù„ÙƒÙ„" Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¬Ù„Ø§Øª</div>
        </div>
      </div>
    </div>
    
  </div>
</div>

<!-- Modal -->
<div id="modal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3 class="modal-title" id="modalTitle">Ø±Ø³Ø§Ù„Ø©</h3>
      <button class="modal-close" id="modalCloseBtn">Ã—</button>
    </div>
    <div id="modalBody"></div>
  </div>
</div>

<script>
const STORAGE_KEY = 'names_manager_db_v5';

const elements = {
  searchInput: document.getElementById('searchInput'),
  searchBtn: document.getElementById('searchBtn'),
  showAllBtn: document.getElementById('showAllBtn'),
  showMissingBtn: document.getElementById('showMissingBtn'),
  searchResults: document.getElementById('searchResults'),
  backupBtn: document.getElementById('backupBtn'),
  restoreBtn: document.getElementById('restoreBtn'),
  fileUploadArea: document.getElementById('fileUploadArea'),
  fileInput: document.getElementById('fileInput'),
  nameInput: document.getElementById('nameInput'),
  qtyInput: document.getElementById('qtyInput'),
  genderInput: document.getElementById('genderInput'),
  colorInput: document.getElementById('colorInput'),
  noteInput: document.getElementById('noteInput'),
  addBtn: document.getElementById('addBtn'),
  updateBtn: document.getElementById('updateBtn'),
  deleteBtn: document.getElementById('deleteBtn'),
  clearFormBtn: document.getElementById('clearFormBtn'),
  sellNameInput: document.getElementById('sellNameInput'),
  sellQtyInput: document.getElementById('sellQtyInput'),
  sellBtn: document.getElementById('sellBtn'),
  checkSellBtn: document.getElementById('checkSellBtn'),
  totalCount: document.getElementById('totalCount'),
  availableCount: document.getElementById('availableCount'),
  missingCount: document.getElementById('missingCount'),
  modal: document.getElementById('modal'),
  modalTitle: document.getElementById('modalTitle'),
  modalBody: document.getElementById('modalBody'),
  modalCloseBtn: document.getElementById('modalCloseBtn')
};

let db = [];
try {
  const stored = localStorage.getItem(STORAGE_KEY);
  db = stored ? JSON.parse(stored) : [];
} catch(e) {
  console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', e);
  db = [];
}

if(db.length === 0) {
  db = [
    {name:'Ø®Ø§Ù„Ø¯',gender:'Ø°ÙƒØ±',qty:25,color:'Ø£Ø²Ø±Ù‚',note:'Ù…Ù‚Ø§Ø³ ØµØºÙŠØ±'},
    {name:'Ø®Ø§Ù„Ø¯Ø©',gender:'Ø£Ù†Ø«Ù‰',qty:10,color:'Ø£Ø­Ù…Ø±',note:'Ù…Ø®ØµØµØ©'},
    {name:'Ø£Ø­Ù…Ø¯',gender:'Ø°ÙƒØ±',qty:0,color:'Ø£Ø®Ø¶Ø±',note:'Ù†Ø§Ù‚Øµ'},
    {name:'ÙØ§Ø·Ù…Ø©',gender:'Ø£Ù†Ø«Ù‰',qty:15,color:'ÙˆØ±Ø¯ÙŠ',note:''},
    {name:'Ù…Ø­Ù…Ø¯',gender:'Ø°ÙƒØ±',qty:30,color:'Ø£Ø³ÙˆØ¯',note:''},
    {name:'Ø¹Ø§Ø¦Ø´Ø©',gender:'Ø£Ù†Ø«Ù‰',qty:0,color:'Ø¨Ù†ÙØ³Ø¬ÙŠ',note:'Ø·Ù„Ø¨ Ø®Ø§Øµ'}
  ];
  saveDB();
}

function saveDB() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(db));
  updateStats();
}

function updateStats() {
  elements.totalCount.textContent = db.length;
  elements.availableCount.textContent = db.filter(function(item) {
    return item.qty > 0;
  }).length;
  elements.missingCount.textContent = db.filter(function(item) {
    return item.qty === 0;
  }).length;
}

function displayResults(items, title) {
  if(items.length === 0) {
    elements.searchResults.innerHTML = '<div class="empty-state"><div class="empty-icon">âŒ</div><div style="font-weight:600">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</div></div>';
    return;
  }
  
  let html = '';
  if(title) {
    html += '<div style="margin-bottom:16px;font-weight:700;color:var(--primary);font-size:15px">' + title + '</div>';
  }
  
  items.forEach(function(item, index) {
    const qtyBadge = item.qty === 0 ? 
      '<span class="result-badge badge-danger">âŒ Ù†Ø§Ù‚Øµ</span>' : 
      '<span class="result-badge badge-success">âœ… ' + item.qty + '</span>';
    
    html += '<div class="result-item" onclick="fillForm(\'' + item.name.replace(/'/g, "\\'") + '\')">';
    html += '<div class="result-name">' + (index + 1) + '. ' + item.name + '</div>';
    html += '<div class="result-info">';
    html += qtyBadge;
    html += '<span class="result-badge">âš§ ' + (item.gender || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯') + '</span>';
    html += '<span class="result-badge">ğŸ¨ ' + (item.color || '-') + '</span>';
    if(item.note) {
      html += '<span class="result-badge">ğŸ“ ' + item.note + '</span>';
    }
    html += '</div></div>';
  });
  
  elements.searchResults.innerHTML = html;
}

function fillForm(name) {
  const item = db.find(function(i) {
    return i.name.toLowerCase() === name.toLowerCase();
  });
  
  if(item) {
    elements.nameInput.value = item.name;
    elements.qtyInput.value = item.qty;
    elements.genderInput.value = item.gender || '';
    elements.colorInput.value = item.color || '';
    elements.noteInput.value = item.note || '';
    showModal('âœ… ØªÙ…', 'ØªÙ… ØªØ¹Ø¨Ø¦Ø© Ø¨ÙŠØ§Ù†Ø§Øª: ' + item.name, 'success');
  }
}

function showModal(title, message, type) {
  type = type || 'info';
  elements.modalTitle.textContent = title;
  
  let alertClass = 'alert-info';
  if(type === 'success') alertClass = 'alert-success';
  if(type === 'error') alertClass = 'alert-danger';
  if(type === 'warning') alertClass = 'alert-warning';
  
  elements.modalBody.innerHTML = '<div class="alert ' + alertClass + '">' + message + '</div>';
  elements.modal.style.display = 'flex';
}

function closeModal() {
  elements.modal.style.display = 'none';
}

elements.searchBtn.addEventListener('click', function() {
  const query = elements.searchInput.value.trim().toLowerCase();
  if(!query) {
    showModal('âš ï¸ ØªÙ†Ø¨ÙŠÙ‡', 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ù†Øµ Ù„Ù„Ø¨Ø­Ø«', 'warning');
    return;
  }
  
  const results = db.filter(function(item) {
    return item.name.toLowerCase().includes(query);
  });
  
  displayResults(results, 'Ù†ØªØ§Ø¦Ø¬: "' + elements.searchInput.value + '"');
});

elements.searchInput.addEventListener('keypress', function(e) {
  if(e.key === 'Enter') {
    elements.searchBtn.click();
  }
});

elements.showAllBtn.addEventListener('click', function() {
  displayResults(db, 'ğŸ“‹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³Ø¬Ù„Ø§Øª (' + db.length + ')');
});

elements.showMissingBtn.addEventListener('click', function() {
  const missing = db.filter(function(item) {
    return item.qty === 0;
  });
  displayResults(missing, 'âŒ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù†Ø§Ù‚ØµØ© (' + missing.length + ')');
});

elements.backupBtn.addEventListener('click', function() {
  if(db.length === 0) {
    showModal('âš ï¸ ØªÙ†Ø¨ÙŠÙ‡', 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ', 'warning');
    return;
  }
  
  let csv = '\ufeffØ§Ù„Ø§Ø³Ù…,Ø§Ù„ÙƒÙ…ÙŠØ©,Ø§Ù„Ø¬Ù†Ø³,Ø§Ù„Ù„ÙˆÙ†,Ù…Ù„Ø§Ø­Ø¸Ø§Øª\n';
  db.forEach(function(item) {
    csv += item.name + ',' + item.qty + ',' + (item.gender || '') + ',' + (item.color || '') + ',"' + (item.note || '') + '"\n';
  });
  
  const blob = new Blob([csv], {type: 'text/csv;charset=utf-8'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'Ù†Ø³Ø®Ø©_Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©_' + new Date().toISOString().split('T')[0] + '.csv';
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
  
  showModal('âœ… Ù†Ø¬Ø­', 'ØªÙ… ØªØ­Ù…ÙŠÙ„ ' + db.length + ' Ø³Ø¬Ù„', 'success');
});

elements.restoreBtn.addEventListener('click', function() {
  elements.fileUploadArea.style.display = 'block';
  elements.fileInput.click();
});

elements.fileUploadArea.addEventListener('click', function() {
  elements.fileInput.click();
});

elements.fileInput.addEventListener('change', function(e) {
  const file = e.target.files[0];
  if(!file) return;
  
  if(!file.name.endsWith('.csv')) {
    showModal('âš ï¸ Ø®Ø·Ø£', 'ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù CSV ÙÙ‚Ø·', 'error');
    return;
  }
  
  const reader = new FileReader();
  reader.onload = function(event) {
    try {
      const content = event.target.result;
      const lines = content.split('\n').filter(function(line) {
        return line.trim();
      });
      
      if(lines.length < 2) {
        showModal('âš ï¸ Ø®Ø·Ø£', 'Ø§Ù„Ù…Ù„Ù ÙØ§Ø±Øº Ø£Ùˆ Ø¨ØªÙ†Ø³ÙŠÙ‚ ØºÙŠØ± ØµØ­ÙŠØ­', 'error');
        return;
      }
      
      const newDB = [];
      for(let i = 1; i < lines.length; i++) {
        const parts = lines[i].split(',');
        if(parts.length >= 3) {
          const name = parts[0].trim();
          const qty = parseInt(parts[1]) || 0;
          const gender = parts[2].trim();
          const color = parts[3] ? parts[3].trim() : '';
          const note = parts[4] ? parts[4].replace(/^"|"$/g, '').trim() : '';
          
          if(name) {
            newDB.push({name: name, qty: qty, gender: gender, color: color, note: note});
          }
        }
      }
      
      if(newDB.length === 0) {
        showModal('âš ï¸ Ø®Ø·Ø£', 'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª ØµØ§Ù„Ø­Ø©', 'error');
        return;
      }
      
      if(confirm('Ø§Ø³ØªØ¨Ø¯Ø§Ù„ ' + db.length + ' Ø³Ø¬Ù„ Ø¨Ù€ ' + newDB.length + ' Ø³Ø¬Ù„ Ù…Ù† Ø§Ù„Ù…Ù„ÙØŸ')) {
        db = newDB;
        saveDB();
        displayResults(db, 'âœ… ØªÙ… Ø§Ù„Ø§Ø³ØªØ±Ø¯Ø§Ø¯');
        elements.fileUploadArea.style.display = 'none';
        showModal('âœ… Ù†Ø¬Ø­', 'ØªÙ… Ø§Ø³ØªØ±Ø¯Ø§Ø¯ ' + newDB.length + ' Ø³Ø¬Ù„', 'success');
      }
    } catch(error) {
      showModal('âš ï¸ Ø®Ø·Ø£', 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù', 'error');
    }
  };
  
  reader.readAsText(file, 'UTF-8');
  elements.fileInput.value = '';
});

elements.clearFormBtn.addEventListener('click', function() {
  elements.nameInput.value = '';
  elements.qtyInput.value = '';
  elements.genderInput.value = '';
  elements.colorInput.value = '';
  elements.noteInput.value = '';
});

elements.addBtn.addEventListener('click', function() {
  const name = elements.nameInput.value.trim();
  const gender = elements.genderInput.value;
  
  if(!name) {
    showModal('âš ï¸ ØªÙ†Ø¨ÙŠÙ‡', 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù…', 'warning');
    return;
  }
  
  if(!gender) {
    showModal('âš ï¸ ØªÙ†Ø¨ÙŠÙ‡', 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¬Ù†Ø³', 'warning');
    return;
  }
  
  const exists = db.some(function(item) {
    return item.name.toLowerCase() === name.toLowerCase();
  });
  
  if(exists) {
    showModal('âš ï¸ Ù…ÙˆØ¬ÙˆØ¯', 'Ø§Ù„Ø§Ø³Ù… "' + name + '" Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ø§Ù‹', 'warning');
    return;
  }
  
  const qty = parseInt(elements.qtyInput.value) || 0;
  const color = elements.colorInput.value.trim();
  const note = elements.noteInput.value.trim();
  
  db.push({name: name, qty: qty, gender: gender, color: color, note: note});
  saveDB();
  
  showModal('âœ… ØªÙ…', 'ØªÙ… Ø¥Ø¶Ø§ÙØ©: ' + name, 'success');
  elements.clearFormBtn.click();
  displayResults(db, 'ğŸ“‹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³Ø¬Ù„Ø§Øª');
});

elements.updateBtn.addEventListener('click', function() {
  const name = elements.nameInput.value.trim();
  
  if(!name) {
    showModal('âš ï¸ ØªÙ†Ø¨ÙŠÙ‡', 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù…', 'warning');
    return;
  }
  
  const index = db.findIndex(function(item) {
    return item.name.toLowerCase() === name.toLowerCase();
  });
  
  if(index === -1) {
    showModal('âš ï¸ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'Ø§Ù„Ø§Ø³Ù… "' + name + '" ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'error');
    return;
  }
  
  const gender = elements.genderInput.value;
  if(!gender) {
    showModal('âš ï¸ ØªÙ†Ø¨ÙŠÙ‡', 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¬Ù†Ø³', 'warning');
    return;
  }
  
  const qty = parseInt(elements.qtyInput.value) || 0;
  const color = elements.colorInput.value.trim();
  const note = elements.noteInput.value.trim();
  
  db[index] = {name: name, qty: qty, gender: gender, color: color, note: note};
  saveDB();
  
  showModal('âœ… ØªÙ…', 'ØªÙ… ØªØ­Ø¯ÙŠØ«: ' + name, 'success');
  displayResults(db, 'ğŸ“‹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³Ø¬Ù„Ø§Øª');
});

elements.deleteBtn.addEventListener('click', function() {
  const name = elements.nameInput.value.trim();
  
  if(!name) {
    showModal('âš ï¸ ØªÙ†Ø¨ÙŠÙ‡', 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù…', 'warning');
    return;
  }
  
  const index = db.findIndex(function(item) {
    return item.name.toLowerCase() === name.toLowerCase();
  });
  
  if(index === -1) {
    showModal('âš ï¸ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'Ø§Ù„Ø§Ø³Ù… "' + name + '" ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'error');
    return;
  }
  
  if(!confirm('Ø­Ø°Ù "' + name + '"ØŸ')) {
    return;
  }
  
  db.splice(index, 1);
  saveDB();
  
  showModal('âœ… ØªÙ…', 'ØªÙ… Ø­Ø°Ù: ' + name, 'success');
  elements.clearFormBtn.click();
  displayResults(db, 'ğŸ“‹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³Ø¬Ù„Ø§Øª');
});

elements.checkSellBtn.addEventListener('click', function() {
  const name = elements.sellNameInput.value.trim();
  
  if(!name) {
    showModal('âš ï¸ ØªÙ†Ø¨ÙŠÙ‡', 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬', 'warning');
    return;
  }
  
  const item = db.find(function(i) {
    return i.name.toLowerCase() === name.toLowerCase();
  });
  
  if(!item) {
    showModal('âš ï¸ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'Ø§Ù„Ù…Ù†ØªØ¬ "' + name + '" ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'error');
    return;
  }
  
  const status = item.qty === 0 ? 
    'âŒ <strong style="color:var(--danger)">ØºÙŠØ± Ù…ØªÙˆÙØ±</strong>' : 
    'âœ… <strong style="color:var(--success)">Ù…ØªÙˆÙØ± (' + item.qty + ')</strong>';
  
  showModal('ğŸ“¦ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†', '<strong>' + item.name + '</strong><br><br>' + status + '<br>Ø§Ù„Ø¬Ù†Ø³: ' + (item.gender || '-') + '<br>Ø§Ù„Ù„ÙˆÙ†: ' + (item.color || '-'), 'info');
});

elements.sellBtn.addEventListener('click', function() {
  const name = elements.sellNameInput.value.trim();
  const sellQty = parseInt(elements.sellQtyInput.value) || 0;
  
  if(!name) {
    showModal('âš ï¸ ØªÙ†Ø¨ÙŠÙ‡', 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬', 'warning');
    return;
  }
  
  if(sellQty <= 0) {
    showModal('âš ï¸ ØªÙ†Ø¨ÙŠÙ‡', 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ…ÙŠØ© ØµØ­ÙŠØ­Ø©', 'warning');
    return;
  }
  
  const index = db.findIndex(function(item) {
    return item.name.toLowerCase() === name.toLowerCase();
  });
  
  if(index === -1) {
    showModal('âš ï¸ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'Ø§Ù„Ù…Ù†ØªØ¬ "' + name + '" ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'error');
    return;
  }
  
  if(db[index].qty < sellQty) {
    showModal('âš ï¸ ÙƒÙ…ÙŠØ© ØºÙŠØ± ÙƒØ§ÙÙŠØ©', 'Ø§Ù„Ù…ØªØ§Ø­: ' + db[index].qty + '<br>Ø§Ù„Ù…Ø·Ù„ÙˆØ¨: ' + sellQty, 'error');
    return;
  }
  
  if(!confirm('Ø¨ÙŠØ¹ ' + sellQty + ' Ù…Ù† "' + name + '"ØŸ')) {
    return;
  }
  
  db[index].qty -= sellQty;
  saveDB();
  
  showModal('âœ… ØªÙ… Ø§Ù„Ø¨ÙŠØ¹', '<strong>' + name + '</strong><br><br>Ø§Ù„Ù…Ø¨Ø§Ø¹: ' + sellQty + '<br>Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ' + db[index].qty, 'success');
  
  elements.sellNameInput.value = '';
  elements.sellQtyInput.value = '';
});

elements.modalCloseBtn.addEventListener('click', closeModal);

elements.modal.addEventListener('click', function(e) {
  if(e.target === elements.modal) {
    closeModal();
  }
});

document.addEventListener('keydown', function(e) {
  if(e.key === 'Escape') {
    closeModal();
  }
  
  if(e.ctrlKey && e.key === 'f') {
    e.preventDefault();
    elements.searchInput.focus();
  }
  
  if(e.ctrlKey && e.key === 's') {
    e.preventDefault();
    elements.backupBtn.click();
  }
});

updateStats();

console.log('âœ… Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø¬Ø§Ù‡Ø²');
console.log('ğŸ“Š Ø§Ù„Ø³Ø¬Ù„Ø§Øª: ' + db.length);
</script>
</body>
</html>
