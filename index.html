<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
<title>Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø³Ù…Ø§Ø¡</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
*{
  box-sizing:border-box;
  margin:0;
  padding:0;
}

body{
  font-family:'Cairo',sans-serif;
  background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
  padding:20px;
  min-height:100vh;
}

.container{
  max-width:1000px;
  margin:0 auto;
}

.header{
  background:white;
  padding:24px;
  border-radius:16px;
  margin-bottom:20px;
  box-shadow:0 4px 20px rgba(0,0,0,0.15);
  border:3px solid #4338ca;
}

.header h1{
  font-size:26px;
  color:#4338ca;
  margin-bottom:16px;
  text-align:center;
}

.stats-row{
  display:flex;
  gap:12px;
  justify-content:center;
  flex-wrap:wrap;
}

.stat-box{
  background:linear-gradient(135deg,#4338ca,#6366f1);
  color:white;
  padding:12px 24px;
  border-radius:10px;
  font-weight:700;
  font-size:15px;
  box-shadow:0 2px 10px rgba(67,56,202,0.3);
}

.grid-layout{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:20px;
}

.card{
  background:white;
  padding:24px;
  border-radius:16px;
  box-shadow:0 4px 20px rgba(0,0,0,0.15);
  border:3px solid #4338ca;
}

.card-title{
  font-size:18px;
  font-weight:800;
  color:#4338ca;
  margin-bottom:20px;
  padding-bottom:12px;
  border-bottom:3px solid #e0e7ff;
  display:flex;
  align-items:center;
  gap:8px;
}

.input-group{
  margin-bottom:16px;
}

.input-group label{
  display:block;
  font-size:14px;
  font-weight:700;
  color:#1f2937;
  margin-bottom:8px;
}

.input-group input,
.input-group select,
.input-group textarea{
  width:100%;
  padding:12px 16px;
  border:2px solid #9ca3af;
  border-radius:10px;
  font-size:15px;
  font-weight:600;
  font-family:'Cairo',sans-serif;
  outline:none;
  transition:all 0.2s;
}

.input-group input:focus,
.input-group select:focus,
.input-group textarea:focus{
  border-color:#4338ca;
  box-shadow:0 0 0 3px rgba(67,56,202,0.1);
}

.input-group textarea{
  min-height:90px;
  resize:vertical;
}

.input-row{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:12px;
}

.btn{
  width:100%;
  padding:12px 20px;
  border:none;
  border-radius:10px;
  font-size:14px;
  font-weight:700;
  cursor:pointer;
  transition:all 0.2s;
  display:flex;
  align-items:center;
  justify-content:center;
  gap:8px;
  font-family:'Cairo',sans-serif;
}

.btn-primary{
  background:linear-gradient(135deg,#4338ca,#6366f1);
  color:white;
  box-shadow:0 2px 10px rgba(67,56,202,0.3);
}

.btn-primary:hover{
  transform:translateY(-2px);
  box-shadow:0 4px 15px rgba(67,56,202,0.4);
}

.btn-success{
  background:linear-gradient(135deg,#10b981,#059669);
  color:white;
}

.btn-success:hover{
  transform:translateY(-2px);
}

.btn-danger{
  background:linear-gradient(135deg,#ef4444,#dc2626);
  color:white;
}

.btn-warning{
  background:linear-gradient(135deg,#f59e0b,#d97706);
  color:white;
}

.btn-outline{
  background:white;
  color:#4338ca;
  border:2px solid #4338ca;
}

.btn-outline:hover{
  background:#f5f3ff;
}

.btn-grid{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:10px;
  margin-top:16px;
}

.search-area{
  display:flex;
  gap:10px;
  margin-bottom:16px;
}

.search-area input{
  flex:1;
  padding:12px 16px;
  border:2px solid #9ca3af;
  border-radius:10px;
  font-size:15px;
  font-weight:600;
  outline:none;
}

.search-area input:focus{
  border-color:#4338ca;
}

.results-box{
  margin-top:20px;
  padding:16px;
  background:#f9fafb;
  border-radius:10px;
  border:2px solid #d1d5db;
  max-height:400px;
  overflow-y:auto;
}

.result-item{
  background:white;
  padding:14px;
  margin-bottom:10px;
  border-radius:8px;
  border:2px solid #e5e7eb;
  cursor:pointer;
  transition:all 0.2s;
}

.result-item:hover{
  border-color:#4338ca;
  transform:translateX(-4px);
  box-shadow:0 2px 10px rgba(67,56,202,0.2);
}

.result-name{
  font-size:16px;
  font-weight:700;
  color:#1f2937;
  margin-bottom:8px;
}

.result-tags{
  display:flex;
  gap:8px;
  flex-wrap:wrap;
  font-size:13px;
}

.tag{
  padding:4px 12px;
  border-radius:6px;
  font-weight:600;
  border:2px solid;
}

.tag-success{
  background:#d1fae5;
  color:#065f46;
  border-color:#10b981;
}

.tag-danger{
  background:#fee2e2;
  color:#991b1b;
  border-color:#ef4444;
}

.tag-info{
  background:#e0e7ff;
  color:#3730a3;
  border-color:#6366f1;
}

.empty-msg{
  text-align:center;
  padding:40px 20px;
  color:#6b7280;
}

.empty-icon{
  font-size:48px;
  margin-bottom:12px;
  opacity:0.5;
}

.modal{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.6);
  backdrop-filter:blur(5px);
  z-index:1000;
  align-items:center;
  justify-content:center;
  padding:20px;
}

.modal-box{
  background:white;
  border-radius:16px;
  padding:28px;
  max-width:500px;
  width:100%;
  box-shadow:0 20px 60px rgba(0,0,0,0.3);
  border:3px solid #4338ca;
}

.modal-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:20px;
  padding-bottom:16px;
  border-bottom:3px solid #e0e7ff;
}

.modal-title{
  font-size:20px;
  font-weight:800;
  color:#4338ca;
}

.modal-close{
  background:#ef4444;
  color:white;
  border:none;
  width:36px;
  height:36px;
  border-radius:50%;
  font-size:20px;
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:center;
  transition:all 0.2s;
}

.modal-close:hover{
  transform:rotate(90deg);
}

.alert{
  padding:16px;
  border-radius:10px;
  font-size:15px;
  font-weight:600;
  line-height:1.7;
}

.alert-success{
  background:#d1fae5;
  color:#065f46;
  border-right:4px solid #10b981;
}

.alert-danger{
  background:#fee2e2;
  color:#991b1b;
  border-right:4px solid #ef4444;
}

.alert-warning{
  background:#fef3c7;
  color:#92400e;
  border-right:4px solid #f59e0b;
}

.alert-info{
  background:#dbeafe;
  color:#1e40af;
  border-right:4px solid #3b82f6;
}

@media (max-width:768px){
  body{
    padding:10px;
  }
  
  .grid-layout{
    grid-template-columns:1fr;
  }
  
  .input-row{
    grid-template-columns:1fr;
  }
  
  .btn-grid{
    grid-template-columns:1fr;
  }
  
  .search-area{
    flex-direction:column;
  }
  
  .header h1{
    font-size:20px;
  }
  
  .stat-box{
    flex:1;
    text-align:center;
  }
}
</style>
</head>
<body>

<div class="container">
  <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± -->
  <div class="header">
    <h1>ğŸ—‚ï¸ Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø³Ù…Ø§Ø¡</h1>
    <div class="stats-row">
      <div class="stat-box">ğŸ“Š Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <span id="totalCount">0</span></div>
      <div class="stat-box">âœ… Ù…ØªÙˆÙØ±: <span id="availableCount">0</span></div>
      <div class="stat-box">âŒ Ù†Ø§Ù‚Øµ: <span id="missingCount">0</span></div>
    </div>
  </div>

  <div class="grid-layout">
    <!-- Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„Ù†ØªØ§Ø¦Ø¬ -->
    <div class="card">
      <div class="card-title">ğŸ” Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„Ø¹Ø±Ø¶</div>
      
      <div class="search-area">
        <input type="text" id="searchInput" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ø³Ù…...">
        <button class="btn btn-primary" id="searchBtn" style="width:auto;padding:12px 24px">Ø¨Ø­Ø«</button>
      </div>
      
      <div class="btn-grid">
        <button class="btn btn-outline" id="showAllBtn">ğŸ“‹ Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„</button>
        <button class="btn btn-outline" id="showMissingBtn">âŒ Ø§Ù„Ù†Ø§Ù‚Øµ</button>
      </div>
      
      <div class="results-box" id="resultsBox">
        <div class="empty-msg">
          <div class="empty-icon">ğŸ”</div>
          <div style="font-weight:700">Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¨Ø­Ø« Ø£Ùˆ Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„</div>
        </div>
      </div>
    </div>

    <!-- Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø³Ø¬Ù„Ø§Øª -->
    <div class="card">
      <div class="card-title">âœï¸ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø³Ø¬Ù„Ø§Øª</div>
      
      <div class="input-group">
        <label>Ø§Ù„Ø§Ø³Ù…</label>
        <input type="text" id="nameInput" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù…">
      </div>
      
      <div class="input-row">
        <div class="input-group">
          <label>Ø§Ù„ÙƒÙ…ÙŠØ©</label>
          <input type="number" id="qtyInput" placeholder="0" min="0">
        </div>
        <div class="input-group">
          <label>Ø§Ù„Ø¬Ù†Ø³</label>
          <select id="genderInput">
            <option value="">Ø§Ø®ØªØ±</option>
            <option value="Ø°ÙƒØ±">ğŸ‘¦ Ø°ÙƒØ±</option>
            <option value="Ø£Ù†Ø«Ù‰">ğŸ‘§ Ø£Ù†Ø«Ù‰</option>
          </select>
        </div>
      </div>
      
      <div class="input-group">
        <label>Ø§Ù„Ù„ÙˆÙ†</label>
        <input type="text" id="colorInput" placeholder="Ø§Ù„Ù„ÙˆÙ†">
      </div>
      
      <div class="input-group">
        <label>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
        <textarea id="noteInput" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©..."></textarea>
      </div>
      
      <div class="btn-grid">
        <button class="btn btn-success" id="addBtn">â• Ø¥Ø¶Ø§ÙØ©</button>
        <button class="btn btn-primary" id="updateBtn">âœï¸ ØªØ­Ø¯ÙŠØ«</button>
        <button class="btn btn-danger" id="deleteBtn">ğŸ—‘ï¸ Ø­Ø°Ù</button>
        <button class="btn btn-outline" id="clearBtn">ğŸ§¹ Ù…Ø³Ø­</button>
      </div>
    </div>

    <!-- Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¨ÙŠØ¹ -->
    <div class="card">
      <div class="card-title">ğŸ›’ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¨ÙŠØ¹</div>
      
      <div class="input-group">
        <label>Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬</label>
        <input type="text" id="sellName" placeholder="Ø§Ù„Ø§Ø³Ù…">
      </div>
      
      <div class="input-group">
        <label>Ø§Ù„ÙƒÙ…ÙŠØ©</label>
        <input type="number" id="sellQty" placeholder="0" min="1">
      </div>
      
      <div class="btn-grid">
        <button class="btn btn-warning" id="sellBtn">ğŸ’° Ø¨ÙŠØ¹</button>
        <button class="btn btn-outline" id="checkBtn">ğŸ” ÙØ­Øµ</button>
      </div>
    </div>

    <!-- Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ -->
    <div class="card">
      <div class="card-title">ğŸ’¾ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ</div>
      
      <div class="btn-grid">
        <button class="btn btn-success" id="backupBtn">â¬‡ï¸ ØªØ­Ù…ÙŠÙ„</button>
        <button class="btn btn-primary" id="restoreBtn">â¬†ï¸ Ø§Ø³ØªØ±Ø¯Ø§Ø¯</button>
      </div>
      
      <div id="uploadArea" style="display:none;margin-top:16px;padding:24px;border:3px dashed #9ca3af;border-radius:10px;text-align:center;cursor:pointer;background:#f9fafb">
        <div style="font-size:40px;margin-bottom:8px">ğŸ“</div>
        <div style="font-weight:700;color:#4b5563">Ø§Ù†Ù‚Ø± Ù„Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù CSV</div>
        <input type="file" id="fileInput" accept=".csv" style="display:none">
      </div>
    </div>
  </div>
</div>

<!-- Modal -->
<div id="modal" class="modal">
  <div class="modal-box">
    <div class="modal-header">
      <div class="modal-title" id="modalTitle">Ø±Ø³Ø§Ù„Ø©</div>
      <button class="modal-close" id="modalClose">Ã—</button>
    </div>
    <div id="modalBody"></div>
  </div>
</div>

<script>
const STORAGE_KEY = 'names_db_v6';

let db = [];
try {
  const stored = localStorage.getItem(STORAGE_KEY);
  db = stored ? JSON.parse(stored) : [];
} catch(e) {
  db = [];
}

if(db.length === 0) {
  db = [
    {name:'Ø®Ø§Ù„Ø¯',gender:'Ø°ÙƒØ±',qty:25,color:'Ø£Ø²Ø±Ù‚',note:'Ù…Ù‚Ø§Ø³ ØµØºÙŠØ±'},
    {name:'Ø®Ø§Ù„Ø¯Ø©',gender:'Ø£Ù†Ø«Ù‰',qty:10,color:'Ø£Ø­Ù…Ø±',note:'Ù…Ø®ØµØµØ©'},
    {name:'Ø£Ø­Ù…Ø¯',gender:'Ø°ÙƒØ±',qty:0,color:'Ø£Ø®Ø¶Ø±',note:'Ù†Ø§Ù‚Øµ'},
    {name:'ÙØ§Ø·Ù…Ø©',gender:'Ø£Ù†Ø«Ù‰',qty:15,color:'ÙˆØ±Ø¯ÙŠ',note:''},
    {name:'Ù…Ø­Ù…Ø¯',gender:'Ø°ÙƒØ±',qty:30,color:'Ø£Ø³ÙˆØ¯',note:''},
    {name:'Ø¹Ø§Ø¦Ø´Ø©',gender:'Ø£Ù†Ø«Ù‰',qty:0,color:'Ø¨Ù†ÙØ³Ø¬ÙŠ',note:'Ø·Ù„Ø¨ Ø®Ø§Øµ'}
  ];
  saveDB();
}

function saveDB() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(db));
  updateStats();
}

function updateStats() {
  document.getElementById('totalCount').textContent = db.length;
  document.getElementById('availableCount').textContent = db.filter(i => i.qty > 0).length;
  document.getElementById('missingCount').textContent = db.filter(i => i.qty === 0).length;
}

function showResults(items, title) {
  const box = document.getElementById('resultsBox');
  
  if(items.length === 0) {
    box.innerHTML = '<div class="empty-msg"><div class="empty-icon">âŒ</div><div style="font-weight:700">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</div></div>';
    return;
  }
  
  let html = '';
  if(title) {
    html += '<div style="font-weight:800;color:#4338ca;margin-bottom:12px;font-size:15px">' + title + '</div>';
  }
  
  items.forEach(function(item, idx) {
    const qtyTag = item.qty === 0 ? 
      '<span class="tag tag-danger">âŒ Ù†Ø§Ù‚Øµ</span>' : 
      '<span class="tag tag-success">âœ… ' + item.qty + '</span>';
    
    html += '<div class="result-item" onclick="fillForm(\'' + item.name.replace(/'/g, "\\'") + '\')">';
    html += '<div class="result-name">' + (idx + 1) + '. ' + item.name + '</div>';
    html += '<div class="result-tags">';
    html += qtyTag;
    html += '<span class="tag tag-info">âš§ ' + (item.gender || '-') + '</span>';
    html += '<span class="tag tag-info">ğŸ¨ ' + (item.color || '-') + '</span>';
    if(item.note) {
      html += '<span class="tag tag-info">ğŸ“ ' + item.note + '</span>';
    }
    html += '</div></div>';
  });
  
  box.innerHTML = html;
}

function fillForm(name) {
  const item = db.find(i => i.name.toLowerCase() === name.toLowerCase());
  if(item) {
    document.getElementById('nameInput').value = item.name;
    document.getElementById('qtyInput').value = item.qty;
    document.getElementById('genderInput').value = item.gender || '';
    document.getElementById('colorInput').value = item.color || '';
    document.getElementById('noteInput').value = item.note || '';
    showModal('âœ… ØªÙ…', 'ØªÙ… ØªØ¹Ø¨Ø¦Ø©: ' + item.name, 'success');
  }
}

function showModal(title, msg, type) {
  type = type || 'info';
  document.getElementById('modalTitle').textContent = title;
  
  let cls = 'alert-info';
  if(type === 'success') cls = 'alert-success';
  if(type === 'error') cls = 'alert-danger';
  if(type === 'warning') cls = 'alert-warning';
  
  document.getElementById('modalBody').innerHTML = '<div class="alert ' + cls + '">' + msg + '</div>';
  document.getElementById('modal').style.display = 'flex';
}

function closeModal() {
  document.getElementById('modal').style.display = 'none';
}

// Ø§Ù„Ø¨Ø­Ø«
document.getElementById('searchBtn').addEventListener('click', function() {
  const q = document.getElementById('searchInput').value.trim().toLowerCase();
  if(!q) {
    showModal('âš ï¸ ØªÙ†Ø¨ÙŠÙ‡', 'Ø£Ø¯Ø®Ù„ Ù†Øµ Ù„Ù„Ø¨Ø­Ø«', 'warning');
    return;
  }
  
  const results = db.filter(i => i.name.toLowerCase().includes(q));
  showResults(results, 'Ù†ØªØ§Ø¦Ø¬: "' + document.getElementById('searchInput').value + '" (' + results.length + ')');
});

document.getElementById('searchInput').addEventListener('keypress', function(e) {
  if(e.key === 'Enter') document.getElementById('searchBtn').click();
});

document.getElementById('showAllBtn').addEventListener('click', function() {
  showResults(db, 'ğŸ“‹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³Ø¬Ù„Ø§Øª (' + db.length + ')');
});

document.getElementById('showMissingBtn').addEventListener('click', function() {
  const missing = db.filter(i => i.qty === 0);
  showResults(missing, 'âŒ Ø§Ù„Ù†Ø§Ù‚Øµ (' + missing.length + ')');
});

// Ø¥Ø¶Ø§ÙØ©
document.getElementById('addBtn').addEventListener('click', function() {
  const name = document.getElementById('nameInput').value.trim();
  const gender = document.getElementById('genderInput').value;
  
  if(!name) {
    showModal('âš ï¸ ØªÙ†Ø¨ÙŠÙ‡', 'Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù…', 'warning');
    return;
  }
  if(!gender) {
    showModal('âš ï¸ ØªÙ†Ø¨ÙŠÙ‡', 'Ø§Ø®ØªØ± Ø§Ù„Ø¬Ù†Ø³', 'warning');
    return;
  }
  if(db.some(i => i.name.toLowerCase() === name.toLowerCase())) {
    showModal('âš ï¸ Ù…ÙˆØ¬ÙˆØ¯', 'Ø§Ù„Ø§Ø³Ù… Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ø§Ù‹', 'warning');
    return;
  }
  
  const qty = parseInt(document.getElementById('qtyInput').value) || 0;
  const color = document.getElementById('colorInput').value.trim();
  const note = document.getElementById('noteInput').value.trim();
  
  db.push({name, qty, gender, color, note});
  saveDB();
  showModal('âœ… Ù†Ø¬Ø­', 'ØªÙ… Ø¥Ø¶Ø§ÙØ©: ' + name, 'success');
  document.getElementById('clearBtn').click();
  showResults(db, 'ğŸ“‹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³Ø¬Ù„Ø§Øª');
});

// ØªØ­Ø¯ÙŠØ«
document.getElementById('updateBtn').addEventListener('click', function() {
  const name = document.getElementById('nameInput').value.trim();
  if(!name) {
    showModal('âš ï¸ ØªÙ†Ø¨ÙŠÙ‡', 'Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù…', 'warning');
    return;
  }
  
  const idx = db.findIndex(i => i.name.toLowerCase() === name.toLowerCase());
  if(idx === -1) {
    showModal('âš ï¸ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'Ø§Ù„Ø§Ø³Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'error');
    return;
  }
  
  const gender = document.getElementById('genderInput').value;
  if(!gender) {
    showModal('âš ï¸ ØªÙ†Ø¨ÙŠÙ‡', 'Ø§Ø®ØªØ± Ø§Ù„Ø¬Ù†Ø³', 'warning');
    return;
  }
  
  const qty = parseInt(document.getElementById('qtyInput').value) || 0;
  const color = document.getElementById('colorInput').value.trim();
  const note = document.getElementById('noteInput').value.trim();
  
  db[idx] = {name, qty, gender, color, note};
  saveDB();
  showModal('âœ… Ù†Ø¬Ø­', 'ØªÙ… ØªØ­Ø¯ÙŠØ«: ' + name, 'success');
  showResults(db, 'ğŸ“‹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³Ø¬Ù„Ø§Øª');
});

// Ø­Ø°Ù
document.getElementById('deleteBtn').addEventListener('click', function() {
  const name = document.getElementById('nameInput').value.trim();
  if(!name) {
    showModal('âš ï¸ ØªÙ†Ø¨ÙŠÙ‡', 'Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù…', 'warning');
    return;
  }
  
  const idx = db.findIndex(i => i.name.toLowerCase() === name.toLowerCase());
  if(idx === -1) {
    showModal('âš ï¸ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'Ø§Ù„Ø§Ø³Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'error');
    return;
  }
  
  if(!confirm('Ø­Ø°Ù "' + name + '"ØŸ')) return;
  
  db.splice(idx, 1);
  saveDB();
  showModal('âœ… Ù†Ø¬Ø­', 'ØªÙ… Ø§Ù„Ø­Ø°Ù', 'success');
  document.getElementById('clearBtn').click();
  showResults(db, 'ğŸ“‹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³Ø¬Ù„Ø§Øª');
});

// Ù…Ø³Ø­
document.getElementById('clearBtn').addEventListener('click', function() {
  document.getElementById('nameInput').value = '';
  document.getElementById('qtyInput').value = '';
  document.getElementById('genderInput').value = '';
  document.getElementById('colorInput').value = '';
  document.getElementById('noteInput').value = '';
});

// Ø§Ù„Ø¨ÙŠØ¹
document.getElementById('checkBtn').addEventListener('click', function() {
  const name = document.getElementById('sellName').value.trim();
  if(!name) {
    showModal('âš ï¸ ØªÙ†Ø¨ÙŠÙ‡', 'Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬', 'warning');
    return;
  }
  
  const item = db.find(i => i.name.toLowerCase() === name.toLowerCase());
  if(!item) {
    showModal('âš ï¸ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'error');
    return;
  }
  
  const status = item.qty === 0 ? 
    'âŒ <strong style="color:#ef4444">ØºÙŠØ± Ù…ØªÙˆÙØ±</strong>' : 
    'âœ… <strong style="color:#10b981">Ù…ØªÙˆÙØ± (' + item.qty + ')</strong>';
  
  showModal('ğŸ“¦ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†', '<strong>' + item.name + '</strong><br><br>' + status, 'info');
});

document.getElementById('sellBtn').addEventListener('click', function() {
  const name = document.getElementById('sellName').value.trim();
  const qty = parseInt(document.getElementById('sellQty').value) || 0;
  
  if(!name) {
    showModal('âš ï¸ ØªÙ†Ø¨ÙŠÙ‡', 'Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬', 'warning');
    return;
  }
  if(qty <= 0) {
    showModal('âš ï¸ ØªÙ†Ø¨ÙŠÙ‡', 'Ø£Ø¯Ø®Ù„ ÙƒÙ…ÙŠØ© ØµØ­ÙŠØ­Ø©', 'warning');
    return;
  }
  
  const idx = db.findIndex(i => i.name.toLowerCase() === name.toLowerCase());
  if(idx === -1) {
    showModal('âš ï¸ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'error');
    return;
  }
  if(db[idx].qty < qty) {
    showModal('âš ï¸ ÙƒÙ…ÙŠØ© ØºÙŠØ± ÙƒØ§ÙÙŠØ©', 'Ø§Ù„Ù…ØªØ§Ø­: ' + db[idx].qty + '<br>Ø§Ù„Ù…Ø·Ù„ÙˆØ¨: ' + qty, 'error');
    return;
  }
  
  if(!confirm('Ø¨ÙŠØ¹ ' + qty + ' Ù…Ù† "' + name + '"ØŸ')) return;
  
  db[idx].qty -= qty;
  saveDB();
  showModal('âœ… ØªÙ… Ø§Ù„Ø¨ÙŠØ¹', 'Ø§Ù„Ù…Ø¨Ø§Ø¹: ' + qty + '<br>Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ' + db[idx].qty, 'success');
  
  document.getElementById('sellName').value = '';
  document.getElementById('sellQty').value = '';
});

// Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ
document.getElementById('backupBtn').addEventListener('click', function() {
  if(db.length === 0) {
    showModal('âš ï¸ ØªÙ†Ø¨ÙŠÙ‡', 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª', 'warning');
    return;
  }
  
  let csv = '\ufeffØ§Ù„Ø§Ø³Ù…,Ø§Ù„ÙƒÙ…ÙŠØ©,Ø§Ù„Ø¬Ù†Ø³,Ø§Ù„Ù„ÙˆÙ†,Ù…Ù„Ø§Ø­Ø¸Ø§Øª\n';
  db.forEach(function(i) {
    csv += i.name + ',' + i.qty + ',' + (i.gender || '') + ',' + (i.color || '') + ',"' + (i.note || '') + '"\n';
  });
  
  const blob = new Blob([csv], {type: 'text/csv;charset=utf-8'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'Ù†Ø³Ø®Ø©_Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©_' + new Date().toISOString().split('T')[0] + '.csv';
  a.click();
  URL.revokeObjectURL(url);
  
  showModal('âœ… Ù†Ø¬Ø­', 'ØªÙ… ØªØ­Ù…ÙŠÙ„ ' + db.length + ' Ø³Ø¬Ù„', 'success');
});

document.getElementById('restoreBtn').addEventListener('click', function() {
  document.getElementById('uploadArea').style.display = 'block';
  document.getElementById('fileInput').click();
});

document.getElementById('uploadArea').addEventListener('click', function() {
  document.getElementById('fileInput').click();
});

document.getElementById('fileInput').addEventListener('change', function(e) {
  const file = e.target.files[0];
  if(!file) return;
  
  if(!file.name.endsWith('.csv')) {
    showModal('âš ï¸ Ø®Ø·Ø£', 'Ø§Ø®ØªØ± Ù…Ù„Ù CSV ÙÙ‚Ø·', 'error');
    return;
  }
  
  const reader = new FileReader();
  reader.onload = function(event) {
    try {
      const content = event.target.result;
      const lines = content.split('\n').filter(l => l.trim());
      
      if(lines.length < 2) {
        showModal('âš ï¸ Ø®Ø·Ø£', 'Ø§Ù„Ù…Ù„Ù ÙØ§Ø±Øº', 'error');
        return;
      }
      
      const newDB = [];
      for(let i = 1; i < lines.length; i++) {
        const parts = lines[i].split(',');
        if(parts.length >= 3) {
          const name = parts[0].trim();
          const qty = parseInt(parts[1]) || 0;
          const gender = parts[2].trim();
          const color = parts[3] ? parts[3].trim() : '';
          const note = parts[4] ? parts[4].replace(/^"|"$/g, '').trim() : '';
          
          if(name) {
            newDB.push({name, qty, gender, color, note});
          }
        }
      }
      
      if(newDB.length === 0) {
        showModal('âš ï¸ Ø®Ø·Ø£', 'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª', 'error');
        return;
      }
      
      if(confirm('Ø§Ø³ØªØ¨Ø¯Ø§Ù„ ' + db.length + ' Ø³Ø¬Ù„ Ø¨Ù€ ' + newDB.length + ' Ø³Ø¬Ù„ØŸ')) {
        db = newDB;
        saveDB();
        showResults(db, 'âœ… ØªÙ… Ø§Ù„Ø§Ø³ØªØ±Ø¯Ø§Ø¯');
        document.getElementById('uploadArea').style.display = 'none';
        showModal('âœ… Ù†Ø¬Ø­', 'ØªÙ… Ø§Ø³ØªØ±Ø¯Ø§Ø¯ ' + newDB.length + ' Ø³Ø¬Ù„', 'success');
      }
    } catch(error) {
      showModal('âš ï¸ Ø®Ø·Ø£', 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù', 'error');
    }
  };
  
  reader.readAsText(file, 'UTF-8');
  e.target.value = '';
});

// Ø¥ØºÙ„Ø§Ù‚ Modal
document.getElementById('modalClose').addEventListener('click', closeModal);
document.getElementById('modal').addEventListener('click', function(e) {
  if(e.target === document.getElementById('modal')) closeModal();
});

// Ø§Ø®ØªØµØ§Ø±Ø§Øª Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­
document.addEventListener('keydown', function(e) {
  if(e.key === 'Escape') closeModal();
  if(e.ctrlKey && e.key === 'f') {
    e.preventDefault();
    document.getElementById('searchInput').focus();
  }
  if(e.ctrlKey && e.key === 's') {
    e.preventDefault();
    document.getElementById('backupBtn').click();
  }
});

// ØªÙ‡ÙŠØ¦Ø©
updateStats();

console.log('âœ… Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø¬Ø§Ù‡Ø²');
console.log('ğŸ“Š Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø¬Ù„Ø§Øª: ' + db.length);
</script>
</body>
</html>
