<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<title>Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø³Ù…Ø§Ø¡</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
:root{
  --blue-1:#0f62fe;
  --blue-2:#2f75b5;
  --dark:#1a1a2e;
  --success:#10b981;
  --danger:#ef4444;
  --warning:#f59e0b;
}

*{
  box-sizing:border-box;
  font-family:'Tajawal',sans-serif;
  -webkit-tap-highlight-color:transparent;
}

body{
  background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
  margin:0;
  padding:16px;
  min-height:100vh;
}

.container{
  max-width:1200px;
  margin:0 auto;
  background:rgba(255,255,255,0.98);
  border-radius:20px;
  padding:24px;
  box-shadow:0 20px 60px rgba(0,0,0,0.3);
}

header{
  text-align:center;
  padding-bottom:20px;
  border-bottom:3px solid var(--blue-2);
  margin-bottom:24px;
}

h1{
  margin:0 0 12px 0;
  font-size:28px;
  color:var(--blue-2);
  font-weight:800;
}

.stats{
  display:flex;
  gap:12px;
  justify-content:center;
  flex-wrap:wrap;
  margin-top:16px;
}

.stat-card{
  background:linear-gradient(135deg,var(--blue-2),var(--blue-1));
  color:white;
  padding:12px 20px;
  border-radius:12px;
  font-weight:700;
  box-shadow:0 4px 15px rgba(47,117,181,0.3);
}

.search-section{
  background:linear-gradient(135deg,rgba(102,126,234,0.1),rgba(118,75,162,0.1));
  padding:24px;
  border-radius:16px;
  margin-bottom:24px;
  border:2px solid rgba(102,126,234,0.3);
}

.search-box{
  display:flex;
  gap:12px;
  margin-bottom:16px;
}

.search-box input{
  flex:1;
  padding:16px;
  border:2px solid var(--blue-2);
  border-radius:12px;
  font-size:16px;
  font-weight:600;
  outline:none;
  transition:all 0.3s;
}

.search-box input:focus{
  border-color:var(--blue-1);
  box-shadow:0 0 0 4px rgba(15,98,254,0.2);
}

.btn{
  padding:14px 24px;
  border:none;
  border-radius:12px;
  font-size:15px;
  font-weight:700;
  cursor:pointer;
  transition:all 0.3s;
  display:inline-flex;
  align-items:center;
  gap:8px;
  justify-content:center;
  min-height:50px;
  touch-action:manipulation;
}

.btn-primary{
  background:linear-gradient(135deg,var(--blue-2),var(--blue-1));
  color:white;
  box-shadow:0 4px 15px rgba(15,98,254,0.3);
}

.btn-primary:hover{
  transform:translateY(-2px);
  box-shadow:0 6px 20px rgba(15,98,254,0.4);
}

.btn-primary:active{
  transform:translateY(0);
}

.btn-secondary{
  background:white;
  color:var(--blue-2);
  border:2px solid var(--blue-2);
}

.btn-secondary:hover{
  background:rgba(47,117,181,0.1);
}

.btn-success{
  background:linear-gradient(135deg,#10b981,#059669);
  color:white;
}

.btn-danger{
  background:linear-gradient(135deg,#ef4444,#dc2626);
  color:white;
}

.btn-warning{
  background:linear-gradient(135deg,#f59e0b,#d97706);
  color:white;
}

.btn:disabled{
  opacity:0.5;
  cursor:not-allowed;
}

.button-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
  gap:12px;
  margin-top:16px;
}

.form-section{
  background:white;
  padding:24px;
  border-radius:16px;
  margin-bottom:24px;
  border:2px solid rgba(102,126,234,0.2);
  box-shadow:0 4px 15px rgba(0,0,0,0.05);
}

.form-title{
  font-size:20px;
  font-weight:800;
  color:var(--dark);
  margin:0 0 20px 0;
  padding-bottom:12px;
  border-bottom:2px solid rgba(102,126,234,0.2);
}

.form-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(250px,1fr));
  gap:16px;
}

.field{
  display:flex;
  flex-direction:column;
}

label{
  font-size:14px;
  font-weight:700;
  margin-bottom:8px;
  color:var(--dark);
}

input,select,textarea{
  padding:14px;
  border:2px solid #ddd;
  border-radius:10px;
  font-size:15px;
  font-weight:600;
  outline:none;
  transition:all 0.3s;
}

input:focus,select:focus,textarea:focus{
  border-color:var(--blue-2);
  box-shadow:0 0 0 3px rgba(47,117,181,0.1);
}

textarea{
  min-height:100px;
  resize:vertical;
  font-family:'Tajawal',sans-serif;
}

.results{
  background:white;
  padding:20px;
  border-radius:12px;
  margin-top:20px;
  max-height:400px;
  overflow-y:auto;
  border:2px solid rgba(102,126,234,0.2);
}

.result-item{
  background:linear-gradient(135deg,rgba(102,126,234,0.05),rgba(118,75,162,0.05));
  padding:16px;
  border-radius:10px;
  margin-bottom:12px;
  border-right:4px solid var(--blue-2);
  transition:all 0.3s;
  cursor:pointer;
}

.result-item:hover{
  transform:translateX(-5px);
  box-shadow:0 4px 15px rgba(0,0,0,0.1);
}

.result-name{
  font-size:18px;
  font-weight:700;
  color:var(--blue-2);
  margin-bottom:8px;
}

.result-details{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(150px,1fr));
  gap:8px;
  font-size:14px;
  color:#666;
}

.detail-item{
  background:white;
  padding:8px 12px;
  border-radius:6px;
  font-weight:600;
}

.modal{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.7);
  backdrop-filter:blur(8px);
  z-index:1000;
  padding:20px;
  align-items:center;
  justify-content:center;
}

.modal-content{
  background:white;
  border-radius:16px;
  padding:28px;
  max-width:600px;
  width:100%;
  max-height:80vh;
  overflow-y:auto;
  box-shadow:0 20px 60px rgba(0,0,0,0.3);
}

.modal-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:20px;
  padding-bottom:16px;
  border-bottom:2px solid rgba(102,126,234,0.2);
}

.modal-title{
  font-size:22px;
  font-weight:800;
  color:var(--blue-2);
  margin:0;
}

.modal-close{
  background:var(--danger);
  color:white;
  border:none;
  width:36px;
  height:36px;
  border-radius:50%;
  cursor:pointer;
  font-size:20px;
  display:flex;
  align-items:center;
  justify-content:center;
  transition:all 0.3s;
}

.modal-close:hover{
  transform:rotate(90deg);
}

.modal-body{
  font-size:15px;
  line-height:1.8;
  color:#333;
}

.alert{
  padding:16px;
  border-radius:10px;
  margin-bottom:16px;
  font-weight:600;
}

.alert-success{
  background:#d1fae5;
  color:#065f46;
  border-right:4px solid var(--success);
}

.alert-danger{
  background:#fee2e2;
  color:#991b1b;
  border-right:4px solid var(--danger);
}

.alert-warning{
  background:#fef3c7;
  color:#92400e;
  border-right:4px solid var(--warning);
}

.alert-info{
  background:#dbeafe;
  color:#1e40af;
  border-right:4px solid var(--blue-2);
}

.file-upload-area{
  border:3px dashed var(--blue-2);
  border-radius:12px;
  padding:32px;
  text-align:center;
  background:rgba(102,126,234,0.05);
  cursor:pointer;
  transition:all 0.3s;
  margin-top:20px;
}

.file-upload-area:hover{
  background:rgba(102,126,234,0.1);
  border-color:var(--blue-1);
}

.file-upload-icon{
  font-size:48px;
  margin-bottom:12px;
}

.empty-state{
  text-align:center;
  padding:40px;
  color:#999;
}

.empty-state-icon{
  font-size:64px;
  margin-bottom:16px;
  opacity:0.5;
}

@media (max-width:768px){
  body{
    padding:8px;
  }
  
  .container{
    padding:16px;
    border-radius:16px;
  }
  
  h1{
    font-size:22px;
  }
  
  .search-box{
    flex-direction:column;
  }
  
  .button-grid{
    grid-template-columns:1fr;
  }
  
  .form-grid{
    grid-template-columns:1fr;
  }
  
  .result-details{
    grid-template-columns:1fr;
  }
  
  .btn{
    width:100%;
  }
  
  .modal-content{
    padding:20px;
  }
}
</style>
</head>
<body>
<div class="container">
  <header>
    <h1>ğŸ” Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø³Ù…Ø§Ø¡</h1>
    <div class="stats">
      <div class="stat-card">ğŸ“Š Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <span id="totalCount">0</span></div>
      <div class="stat-card">âœ… Ù…ØªÙˆÙØ±: <span id="availableCount">0</span></div>
      <div class="stat-card">âŒ Ù†Ø§Ù‚Øµ: <span id="missingCount">0</span></div>
    </div>
  </header>

  <div class="search-section">
    <h2 class="form-title">ğŸ” Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø£Ø³Ù…Ø§Ø¡</h2>
    <div class="search-box">
      <input type="text" id="searchInput" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù… Ù„Ù„Ø¨Ø­Ø«..." autocomplete="off">
      <button class="btn btn-primary" id="searchBtn">ğŸ” Ø¨Ø­Ø«</button>
    </div>
    <div class="button-grid">
      <button class="btn btn-secondary" id="showAllBtn">ğŸ“‹ Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„</button>
      <button class="btn btn-secondary" id="showMissingBtn">âŒ Ø¹Ø±Ø¶ Ø§Ù„Ù†Ø§Ù‚Øµ</button>
      <button class="btn btn-secondary" id="clearSearchBtn">ğŸ§¹ Ù…Ø³Ø­ Ø§Ù„Ø¨Ø­Ø«</button>
    </div>
    <div id="searchResults"></div>
  </div>

  <div class="form-section">
    <h2 class="form-title">ğŸ’¾ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ ÙˆØ§Ù„Ø§Ø³ØªØ±Ø¯Ø§Ø¯</h2>
    <div class="alert alert-info" style="margin-bottom:20px">
      ğŸ’¡ ÙŠÙ…ÙƒÙ†Ùƒ Ø­ÙØ¸ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ± ÙˆØ§Ø³ØªØ±Ø¯Ø§Ø¯Ù‡Ø§ ÙÙŠ Ø£ÙŠ ÙˆÙ‚Øª
    </div>
    <div class="button-grid">
      <button class="btn btn-success" id="backupBtn">â¬‡ï¸ ØªØ­Ù…ÙŠÙ„ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©</button>
      <button class="btn btn-primary" id="restoreBtn">â¬†ï¸ Ø§Ø³ØªØ±Ø¯Ø§Ø¯ Ù…Ù† Ù…Ù„Ù</button>
    </div>
    <div id="fileUploadArea" class="file-upload-area" style="display:none">
      <div class="file-upload-icon">ğŸ“</div>
      <div style="font-size:16px;font-weight:700;margin-bottom:8px">Ø§Ø³Ø­Ø¨ Ø§Ù„Ù…Ù„Ù Ù‡Ù†Ø§ Ø£Ùˆ Ø§Ù†Ù‚Ø± Ù„Ù„Ø§Ø®ØªÙŠØ§Ø±</div>
      <div style="font-size:13px;color:#666">ÙŠØ¯Ø¹Ù… Ù…Ù„ÙØ§Øª CSV ÙÙ‚Ø·</div>
      <input type="file" id="fileInput" accept=".csv" style="display:none">
    </div>
  </div>

  <div class="form-section">
    <h2 class="form-title">âœï¸ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø³Ø¬Ù„Ø§Øª</h2>
    <div class="form-grid">
      <div class="field">
        <label>Ø§Ù„Ø§Ø³Ù…</label>
        <input type="text" id="nameInput" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù…">
      </div>
      <div class="field">
        <label>Ø§Ù„ÙƒÙ…ÙŠØ©</label>
        <input type="number" id="qtyInput" placeholder="0" min="0">
      </div>
      <div class="field">
        <label>Ø§Ù„Ø¬Ù†Ø³</label>
        <select id="genderInput">
          <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¬Ù†Ø³</option>
          <option value="Ø°ÙƒØ±">ğŸ‘¦ Ø°ÙƒØ±</option>
          <option value="Ø£Ù†Ø«Ù‰">ğŸ‘§ Ø£Ù†Ø«Ù‰</option>
        </select>
      </div>
      <div class="field">
        <label>Ø§Ù„Ù„ÙˆÙ†</label>
        <input type="text" id="colorInput" placeholder="Ø§Ù„Ù„ÙˆÙ†">
      </div>
    </div>
    <div class="field" style="margin-top:16px">
      <label>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
      <textarea id="noteInput" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©..."></textarea>
    </div>
    <div class="button-grid" style="margin-top:20px">
      <button class="btn btn-success" id="addBtn">â• Ø¥Ø¶Ø§ÙØ© Ø¬Ø¯ÙŠØ¯</button>
      <button class="btn btn-primary" id="updateBtn">âœï¸ ØªØ­Ø¯ÙŠØ«</button>
      <button class="btn btn-danger" id="deleteBtn">ğŸ—‘ï¸ Ø­Ø°Ù</button>
      <button class="btn btn-secondary" id="clearFormBtn">ğŸ§¹ Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚ÙˆÙ„</button>
    </div>
  </div>

  <div class="form-section">
    <h2 class="form-title">ğŸ›’ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¨ÙŠØ¹</h2>
    <div class="form-grid">
      <div class="field">
        <label>Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬</label>
        <input type="text" id="sellNameInput" placeholder="Ø§Ù„Ø§Ø³Ù…">
      </div>
      <div class="field">
        <label>Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø¨Ø§Ø¹Ø©</label>
        <input type="number" id="sellQtyInput" placeholder="0" min="1">
      </div>
    </div>
    <div class="button-grid" style="margin-top:20px">
      <button class="btn btn-warning" id="sellBtn">ğŸ’° ØªÙ†ÙÙŠØ° Ø§Ù„Ø¨ÙŠØ¹</button>
      <button class="btn btn-secondary" id="checkSellBtn">ğŸ” ÙØ­Øµ Ø§Ù„ÙƒÙ…ÙŠØ©</button>
    </div>
  </div>
</div>

<div id="modal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3 class="modal-title" id="modalTitle">Ø±Ø³Ø§Ù„Ø©</h3>
      <button class="modal-close" id="modalCloseBtn">Ã—</button>
    </div>
    <div class="modal-body" id="modalBody"></div>
  </div>
</div>

<script>
const STORAGE_KEY = 'names_manager_db_v4';

const elements = {
  searchInput: document.getElementById('searchInput'),
  searchBtn: document.getElementById('searchBtn'),
  showAllBtn: document.getElementById('showAllBtn'),
  showMissingBtn: document.getElementById('showMissingBtn'),
  clearSearchBtn: document.getElementById('clearSearchBtn'),
  searchResults: document.getElementById('searchResults'),
  backupBtn: document.getElementById('backupBtn'),
  restoreBtn: document.getElementById('restoreBtn'),
  fileUploadArea: document.getElementById('fileUploadArea'),
  fileInput: document.getElementById('fileInput'),
  nameInput: document.getElementById('nameInput'),
  qtyInput: document.getElementById('qtyInput'),
  genderInput: document.getElementById('genderInput'),
  colorInput: document.getElementById('colorInput'),
  noteInput: document.getElementById('noteInput'),
  addBtn: document.getElementById('addBtn'),
  updateBtn: document.getElementById('updateBtn'),
  deleteBtn: document.getElementById('deleteBtn'),
  clearFormBtn: document.getElementById('clearFormBtn'),
  sellNameInput: document.getElementById('sellNameInput'),
  sellQtyInput: document.getElementById('sellQtyInput'),
  sellBtn: document.getElementById('sellBtn'),
  checkSellBtn: document.getElementById('checkSellBtn'),
  totalCount: document.getElementById('totalCount'),
  availableCount: document.getElementById('availableCount'),
  missingCount: document.getElementById('missingCount'),
  modal: document.getElementById('modal'),
  modalTitle: document.getElementById('modalTitle'),
  modalBody: document.getElementById('modalBody'),
  modalCloseBtn: document.getElementById('modalCloseBtn')
};

let db = [];
try {
  const stored = localStorage.getItem(STORAGE_KEY);
  db = stored ? JSON.parse(stored) : [];
} catch(e) {
  console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', e);
  db = [];
}

if(db.length === 0) {
  db = [
    {name:'Ø®Ø§Ù„Ø¯',gender:'Ø°ÙƒØ±',qty:25,color:'Ø£Ø²Ø±Ù‚',note:'Ù…Ù‚Ø§Ø³ ØµØºÙŠØ±'},
    {name:'Ø®Ø§Ù„Ø¯Ø©',gender:'Ø£Ù†Ø«Ù‰',qty:10,color:'Ø£Ø­Ù…Ø±',note:'Ù…Ø®ØµØµØ©'},
    {name:'Ø£Ø­Ù…Ø¯',gender:'Ø°ÙƒØ±',qty:0,color:'Ø£Ø®Ø¶Ø±',note:'Ù†Ø§Ù‚Øµ'},
    {name:'ÙØ§Ø·Ù…Ø©',gender:'Ø£Ù†Ø«Ù‰',qty:15,color:'ÙˆØ±Ø¯ÙŠ',note:''},
    {name:'Ù…Ø­Ù…Ø¯',gender:'Ø°ÙƒØ±',qty:30,color:'Ø£Ø³ÙˆØ¯',note:''},
    {name:'Ø¹Ø§Ø¦Ø´Ø©',gender:'Ø£Ù†Ø«Ù‰',qty:0,color:'Ø¨Ù†ÙØ³Ø¬ÙŠ',note:'Ø·Ù„Ø¨ Ø®Ø§Øµ'}
  ];
  saveDB();
}

function saveDB() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(db));
  updateStats();
}

function updateStats() {
  elements.totalCount.textContent = db.length;
  elements.availableCount.textContent = db.filter(item => item.qty > 0).length;
  elements.missingCount.textContent = db.filter(item => item.qty === 0).length;
}

function displayResults(items, title) {
  if(items.length === 0) {
    elements.searchResults.innerHTML = '<div class="empty-state"><div class="empty-state-icon">ğŸ”</div><div style="font-size:18px;font-weight:700">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</div></div>';
    return;
  }
  
  let html = '<div class="results">';
  if(title) {
    html += '<h3 style="margin:0 0 16px 0;color:var(--blue-2)">' + title + '</h3>';
  }
  
  items.forEach(function(item, index) {
    const qtyColor = item.qty === 0 ? '#ef4444' : '#10b981';
    html += '<div class="result-item" onclick="fillForm(\'' + item.name + '\')">';
    html += '<div class="result-name">' + (index + 1) + '. ' + item.name + '</div>';
    html += '<div class="result-details">';
    html += '<div class="detail-item" style="color:' + qtyColor + '">ğŸ“¦ Ø§Ù„ÙƒÙ…ÙŠØ©: ' + item.qty + '</div>';
    html += '<div class="detail-item">âš§ ' + (item.gender || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯') + '</div>';
    html += '<div class="detail-item">ğŸ¨ ' + (item.color || 'Ø¨Ø¯ÙˆÙ† Ù„ÙˆÙ†') + '</div>';
    if(item.note) {
      html += '<div class="detail-item" style="grid-column:1/-1">ğŸ“ ' + item.note + '</div>';
    }
    html += '</div></div>';
  });
  
  html += '</div>';
  elements.searchResults.innerHTML = html;
}

function fillForm(name) {
  const item = db.find(function(i) {
    return i.name.toLowerCase() === name.toLowerCase();
  });
  
  if(item) {
    elements.nameInput.value = item.name;
    elements.qtyInput.value = item.qty;
    elements.genderInput.value = item.gender || '';
    elements.colorInput.value = item.color || '';
    elements.noteInput.value = item.note || '';
    showModal('âœ… ØªÙ… Ø§Ù„ØªØ¹Ø¨Ø¦Ø©', 'ØªÙ… ØªØ¹Ø¨Ø¦Ø© Ø¨ÙŠØ§Ù†Ø§Øª: ' + item.name, 'success');
  }
}

function showModal(title, message, type) {
  type = type || 'info';
  elements.modalTitle.textContent = title;
  
  let alertClass = 'alert-info';
  if(type === 'success') alertClass = 'alert-success';
  if(type === 'error') alertClass = 'alert-danger';
  if(type === 'warning') alertClass = 'alert-warning';
  
  elements.modalBody.innerHTML = '<div class="alert ' + alertClass + '">' + message + '</div>';
  elements.modal.style.display = 'flex';
}

function closeModal() {
  elements.modal.style.display = 'none';
}

elements.searchBtn.addEventListener('click', function() {
  const query = elements.searchInput.value.trim().toLowerCase();
  if(!query) {
    showModal('âš ï¸ ØªÙ†Ø¨ÙŠÙ‡', 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ù†Øµ Ù„Ù„Ø¨Ø­Ø«', 'warning');
    return;
  }
  
  const results = db.filter(function(item) {
    return item.name.toLowerCase().includes(query);
  });
  
  displayResults(results, 'Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù†: "' + elements.searchInput.value + '"');
});

elements.searchInput.addEventListener('keypress', function(e) {
  if(e.key === 'Enter') {
    elements.searchBtn.click();
  }
});

elements.showAllBtn.addEventListener('click', function() {
  displayResults(db, 'ğŸ“‹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³Ø¬Ù„Ø§Øª');
});

elements.showMissingBtn.addEventListener('click', function() {
  const missing = db.filter(function(item) {
    return item.qty === 0;
  });
  displayResults(missing, 'âŒ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù†Ø§Ù‚ØµØ©');
});

elements.clearSearchBtn.addEventListener('click', function() {
  elements.searchInput.value = '';
  elements.searchResults.innerHTML = '';
});

elements.backupBtn.addEventListener('click', function() {
  if(db.length === 0) {
    showModal('âš ï¸ ØªÙ†Ø¨ÙŠÙ‡', 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ', 'warning');
    return;
  }
  
  let csv = '\ufeffØ§Ù„Ø§Ø³Ù…,Ø§Ù„ÙƒÙ…ÙŠØ©,Ø§Ù„Ø¬Ù†Ø³,Ø§Ù„Ù„ÙˆÙ†,Ù…Ù„Ø§Ø­Ø¸Ø§Øª\n';
  db.forEach(function(item) {
    csv += item.name + ',' + item.qty + ',' + (item.gender || '') + ',' + (item.color || '') + ',"' + (item.note || '') + '"\n';
  });
  
  const blob = new Blob([csv], {type: 'text/csv;charset=utf-8'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'Ù†Ø³Ø®Ø©_Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©_' + new Date().toISOString().split('T')[0] + '.csv';
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
  
  showModal('âœ… Ù†Ø¬Ø­', 'ØªÙ… ØªØ­Ù…ÙŠÙ„ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ ' + db.length + ' Ø³Ø¬Ù„', 'success');
});

elements.restoreBtn.addEventListener('click', function() {
  elements.fileUploadArea.style.display = 'block';
  elements.fileInput.click();
});

elements.fileUploadArea.addEventListener('click', function() {
  elements.fileInput.click();
});

elements.fileInput.addEventListener('change', function(e) {
  const file = e.target.files[0];
  if(!file) return;
  
  if(!file.name.endsWith('.csv')) {
    showModal('âš ï¸ Ø®Ø·Ø£', 'ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù CSV ÙÙ‚Ø·', 'error');
    return;
  }
  
  const reader = new FileReader();
  reader.onload = function(event) {
    try {
      const content = event.target.result;
      const lines = content.split('\n').filter(function(line) {
        return line.trim();
      });
      
      if(lines.length < 2) {
        showModal('âš ï¸ Ø®Ø·Ø£', 'Ø§Ù„Ù…Ù„Ù ÙØ§Ø±Øº Ø£Ùˆ Ø¨ØªÙ†Ø³ÙŠÙ‚ ØºÙŠØ± ØµØ­ÙŠØ­', 'error');
        return;
      }
      
      const newDB = [];
      for(let i = 1; i < lines.length; i++) {
        const parts = lines[i].split(',');
        if(parts.length >= 3) {
          const name = parts[0].trim();
          const qty = parseInt(parts[1]) || 0;
          const gender = parts[2].trim();
          const color = parts[3] ? parts[3].trim() : '';
          const note = parts[4] ? parts[4].replace(/^"|"$/g, '').trim() : '';
          
          if(name) {
            newDB.push({name: name, qty: qty, gender: gender, color: color, note: note});
          }
        }
      }
      
      if(newDB.length === 0) {
        showModal('âš ï¸ Ø®Ø·Ø£', 'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª ØµØ§Ù„Ø­Ø© ÙÙŠ Ø§Ù„Ù…Ù„Ù', 'error');
        return;
      }
      
      if(confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ© (' + db.length + ' Ø³Ø¬Ù„) Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ù…Ù„Ù (' + newDB.length + ' Ø³Ø¬Ù„)ØŸ')) {
        db = newDB;
        saveDB();
        displayResults(db, 'âœ… ØªÙ… Ø§Ù„Ø§Ø³ØªØ±Ø¯Ø§Ø¯ Ø¨Ù†Ø¬Ø§Ø­');
        elements.fileUploadArea.style.display = 'none';
        showModal('âœ… Ù†Ø¬Ø­', 'ØªÙ… Ø§Ø³ØªØ±Ø¯Ø§Ø¯ ' + newDB.length + ' Ø³Ø¬Ù„ Ø¨Ù†Ø¬Ø§Ø­', 'success');
      }
    } catch(error) {
      console.error('Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù:', error);
      showModal('âš ï¸ Ø®Ø·Ø£', 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù. ØªØ£ÙƒØ¯ Ù…Ù† ØµØ­Ø© Ø§Ù„ØªÙ†Ø³ÙŠÙ‚', 'error');
    }
  };
  
  reader.readAsText(file, 'UTF-8');
  elements.fileInput.value = '';
});

elements.clearFormBtn.addEventListener('click', function() {
  elements.nameInput.value = '';
  elements.qtyInput.value = '';
  elements.genderInput.value = '';
  elements.colorInput.value = '';
  elements.noteInput.value = '';
});

elements.addBtn.addEventListener('click', function() {
  const name = elements.nameInput.value.trim();
  const gender = elements.genderInput.value;
  
  if(!name) {
    showModal('âš ï¸ ØªÙ†Ø¨ÙŠÙ‡', 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù…', 'warning');
    return;
  }
  
  if(!gender) {
    showModal('âš ï¸ ØªÙ†Ø¨ÙŠÙ‡', 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¬Ù†Ø³', 'warning');
    return;
  }
  
  const exists = db.some(function(item) {
    return item.name.toLowerCase() === name.toLowerCase();
  });
  
  if(exists) {
    showModal('âš ï¸ ØªÙ†Ø¨ÙŠÙ‡', 'Ø§Ù„Ø§Ø³Ù… "' + name + '" Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ø§Ù‹ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'warning');
    return;
  }
  
  const qty = parseInt(elements.qtyInput.value) || 0;
  const color = elements.colorInput.value.trim();
  const note = elements.noteInput.value.trim();
  
  db.push({name: name, qty: qty, gender: gender, color: color, note: note});
  saveDB();
  
  showModal('âœ… ØªÙ… Ø§Ù„Ø¥Ø¶Ø§ÙØ©', 'ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ø¬Ù„ Ø¨Ù†Ø¬Ø§Ø­:<br><br><strong>' + name + '</strong><br>Ø§Ù„ÙƒÙ…ÙŠØ©: ' + qty + '<br>Ø§Ù„Ø¬Ù†Ø³: ' + gender, 'success');
  
  elements.clearFormBtn.click();
  displayResults(db, 'ğŸ“‹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³Ø¬Ù„Ø§Øª');
});

elements.updateBtn.addEventListener('click', function() {
  const name = elements.nameInput.value.trim();
  
  if(!name) {
    showModal('âš ï¸ ØªÙ†Ø¨ÙŠÙ‡', 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… Ù„Ù„ØªØ­Ø¯ÙŠØ«', 'warning');
    return;
  }
  
  const index = db.findIndex(function(item) {
    return item.name.toLowerCase() === name.toLowerCase();
  });
  
  if(index === -1) {
    showModal('âš ï¸ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'Ø§Ù„Ø§Ø³Ù… "' + name + '" ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'error');
    return;
  }
  
  const gender = elements.genderInput.value;
  if(!gender) {
    showModal('âš ï¸ ØªÙ†Ø¨ÙŠÙ‡', 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¬Ù†Ø³', 'warning');
    return;
  }
  
  const qty = parseInt(elements.qtyInput.value) || 0;
  const color = elements.colorInput.value.trim();
  const note = elements.noteInput.value.trim();
  
  db[index] = {name: name, qty: qty, gender: gender, color: color, note: note};
  saveDB();
  
  showModal('âœ… ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«', 'ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¬Ù„ Ø¨Ù†Ø¬Ø§Ø­:<br><br><strong>' + name + '</strong><br>Ø§Ù„ÙƒÙ…ÙŠØ©: ' + qty + '<br>Ø§Ù„Ø¬Ù†Ø³: ' + gender, 'success');
  
  displayResults(db, 'ğŸ“‹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³Ø¬Ù„Ø§Øª');
});

elements.deleteBtn.addEventListener('click', function() {
  const name = elements.nameInput.value.trim();
  
  if(!name) {
    showModal('âš ï¸ ØªÙ†Ø¨ÙŠÙ‡', 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… Ù„Ù„Ø­Ø°Ù', 'warning');
    return;
  }
  
  const index = db.findIndex(function(item) {
    return item.name.toLowerCase() === name.toLowerCase();
  });
  
  if(index === -1) {
    showModal('âš ï¸ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'Ø§Ù„Ø§Ø³Ù… "' + name + '" ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'error');
    return;
  }
  
  if(!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù "' + name + '"ØŸ')) {
    return;
  }
  
  db.splice(index, 1);
  saveDB();
  
  showModal('âœ… ØªÙ… Ø§Ù„Ø­Ø°Ù', 'ØªÙ… Ø­Ø°Ù Ø§Ù„Ø³Ø¬Ù„: ' + name, 'success');
  elements.clearFormBtn.click();
  displayResults(db, 'ğŸ“‹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³Ø¬Ù„Ø§Øª');
});

elements.checkSellBtn.addEventListener('click', function() {
  const name = elements.sellNameInput.value.trim();
  
  if(!name) {
    showModal('âš ï¸ ØªÙ†Ø¨ÙŠÙ‡', 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬', 'warning');
    return;
  }
  
  const item = db.find(function(i) {
    return i.name.toLowerCase() === name.toLowerCase();
  });
  
  if(!item) {
    showModal('âš ï¸ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'Ø§Ù„Ù…Ù†ØªØ¬ "' + name + '" ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'error');
    return;
  }
  
  const qtyStatus = item.qty === 0 ? 
    '<span style="color:#ef4444">âŒ ØºÙŠØ± Ù…ØªÙˆÙØ± (Ø§Ù„ÙƒÙ…ÙŠØ©: 0)</span>' : 
    '<span style="color:#10b981">âœ… Ù…ØªÙˆÙØ± (Ø§Ù„ÙƒÙ…ÙŠØ©: ' + item.qty + ')</span>';
  
  showModal('ğŸ“¦ Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†', '<strong>' + item.name + '</strong><br><br>' + qtyStatus + '<br>Ø§Ù„Ø¬Ù†Ø³: ' + (item.gender || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯') + '<br>Ø§Ù„Ù„ÙˆÙ†: ' + (item.color || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯') + '<br>' + (item.note ? 'Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª: ' + item.note : ''), 'info');
});

elements.sellBtn.addEventListener('click', function() {
  const name = elements.sellNameInput.value.trim();
  const sellQty = parseInt(elements.sellQtyInput.value) || 0;
  
  if(!name) {
    showModal('âš ï¸ ØªÙ†Ø¨ÙŠÙ‡', 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬', 'warning');
    return;
  }
  
  if(sellQty <= 0) {
    showModal('âš ï¸ ØªÙ†Ø¨ÙŠÙ‡', 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ…ÙŠØ© ØµØ­ÙŠØ­Ø©', 'warning');
    return;
  }
  
  const index = db.findIndex(function(item) {
    return item.name.toLowerCase() === name.toLowerCase();
  });
  
  if(index === -1) {
    showModal('âš ï¸ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'Ø§Ù„Ù…Ù†ØªØ¬ "' + name + '" ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'error');
    return;
  }
  
  if(db[index].qty < sellQty) {
    showModal('âš ï¸ ÙƒÙ…ÙŠØ© ØºÙŠØ± ÙƒØ§ÙÙŠØ©', 'Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…ØªØ§Ø­Ø©: ' + db[index].qty + '<br>Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©: ' + sellQty + '<br><br><span style="color:#ef4444">âŒ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¥ØªÙ…Ø§Ù… Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¨ÙŠØ¹</span>', 'error');
    return;
  }
  
  if(!confirm('ØªØ£ÙƒÙŠØ¯ Ø¨ÙŠØ¹ ' + sellQty + ' Ù…Ù† "' + name + '"ØŸ')) {
    return;
  }
  
  db[index].qty -= sellQty;
  saveDB();
  
  showModal('âœ… ØªÙ…Øª Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¨ÙŠØ¹', '<strong>' + name + '</strong><br><br>Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø¨Ø§Ø¹Ø©: ' + sellQty + '<br>Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©: ' + db[index].qty + '<br><br>ğŸ’° ØªÙ…Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­', 'success');
  
  elements.sellNameInput.value = '';
  elements.sellQtyInput.value = '';
});

elements.modalCloseBtn.addEventListener('click', closeModal);

elements.modal.addEventListener('click', function(e) {
  if(e.target === elements.modal) {
    closeModal();
  }
});

document.addEventListener('keydown', function(e) {
  if(e.key === 'Escape') {
    closeModal();
  }
  
  if(e.ctrlKey && e.key === 'f') {
    e.preventDefault();
    elements.searchInput.focus();
  }
  
  if(e.ctrlKey && e.key === 's') {
    e.preventDefault();
    elements.backupBtn.click();
  }
});

updateStats();
displayResults(db, 'ğŸ“‹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³Ø¬Ù„Ø§Øª');

console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø¨Ù†Ø¬Ø§Ø­');
console.log('ğŸ“Š Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø¬Ù„Ø§Øª: ' + db.length);
</script>
</body>
</html>
